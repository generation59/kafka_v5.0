# –ó–∞–¥–∞–Ω–∏–µ 1: –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Kafka-–∫–ª–∞—Å—Ç–µ—Ä–∞

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∫—à–Ω-–≥–æ—Ç–æ–≤–æ–≥–æ Kafka –∫–ª–∞—Å—Ç–µ—Ä–∞ —Å 3 –±—Ä–æ–∫–µ—Ä–∞–º–∏, Zookeeper –∏ Schema Registry. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —Å —É—á–µ—Ç–æ–º best practices –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å—Ä–µ–¥—ã.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

**Kafka –ë—Ä–æ–∫–µ—Ä—ã (3 –Ω–æ–¥—ã):**
- CPU: 4 cores per broker
- RAM: 16 GB per broker  
- Disk: 500 GB SSD per broker (network-ssd –≤ Yandex Cloud)
- Network: 10 Gbps

**Zookeeper (3 –Ω–æ–¥—ã):**
- CPU: 2 cores per node
- RAM: 8 GB per node
- Disk: 30 GB SSD per node

**Schema Registry (1 –Ω–æ–¥–∞):**
- CPU: 2 cores
- RAM: 4 GB
- Disk: 30 GB SSD

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–∏

- Kafka Broker 1: –ø–æ—Ä—Ç 9092
- Kafka Broker 2: –ø–æ—Ä—Ç 9093  
- Kafka Broker 3: –ø–æ—Ä—Ç 9094
- Zookeeper: –ø–æ—Ä—Ç 2181
- Schema Registry: –ø–æ—Ä—Ç 8081

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
task_one/
‚îú‚îÄ‚îÄ README.md                           # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ install_kafka.sh                    # –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Kafka
‚îú‚îÄ‚îÄ install_schema_registry.sh          # –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Schema Registry
‚îú‚îÄ‚îÄ config/                             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ zookeeper.properties           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Zookeeper
‚îÇ   ‚îú‚îÄ‚îÄ server-1.properties            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka Broker 1
‚îÇ   ‚îú‚îÄ‚îÄ server-2.properties            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka Broker 2
‚îÇ   ‚îî‚îÄ‚îÄ server-3.properties            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Kafka Broker 3
‚îú‚îÄ‚îÄ schemas/                            # Avro —Å—Ö–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ user-event.avsc                # –°—Ö–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ python/                             # Python –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt               # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ producer.py                    # Kafka –ø—Ä–æ–¥—é—Å–µ—Ä
‚îÇ   ‚îî‚îÄ‚îÄ consumer.py                    # Kafka –∫–æ–Ω—Å—å—é–º–µ—Ä
‚îî‚îÄ‚îÄ scripts/                           # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
    ‚îú‚îÄ‚îÄ setup_kafka_cluster.sh         # –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
    ‚îî‚îÄ‚îÄ register_schema.sh             # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã –≤ Schema Registry
```

## –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
git clone <repository_url>
cd task_one
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
# –î–µ–ª–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x *.sh scripts/*.sh

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç root –ø—Ä–∞–≤–∞)
sudo ./scripts/setup_kafka_cluster.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç:
- –£—Å—Ç–∞–Ω–æ–≤–∫—É Java 11
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É Kafka
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π kafka –∏ zookeeper
- –ù–∞—Å—Ç—Ä–æ–π–∫—É systemd —Å–µ—Ä–≤–∏—Å–æ–≤
- –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
- –£—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É Schema Registry

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl status zookeeper kafka kafka-2 kafka-3 schema-registry

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u kafka -f
sudo journalctl -u zookeeper -f
sudo journalctl -u schema-registry -f
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–ø–∏–∫–∞

–¢–æ–ø–∏–∫ `user-events` —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º)
/opt/kafka/bin/kafka-topics.sh --create \
    --bootstrap-server localhost:9092,localhost:9093,localhost:9094 \
    --topic user-events \
    --partitions 3 \
    --replication-factor 3 \
    --config cleanup.policy=delete \
    --config retention.ms=604800000 \
    --config segment.bytes=1073741824
```

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Schema Registry

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã
cd scripts
./register_schema.sh
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ø–∏–∫–∞:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π: 3
- –§–∞–∫—Ç–æ—Ä —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏: 3
- –ü–æ–ª–∏—Ç–∏–∫–∞ –æ—á–∏—Å—Ç–∫–∏: `delete`
- –í—Ä–µ–º—è —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 –¥–Ω–µ–π (604800000 –º—Å)
- –†–∞–∑–º–µ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞: 1 GB (1073741824 –±–∞–π—Ç)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ISR: 2

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—Ä–æ–∫–µ—Ä–æ–≤:**
- –ö–æ–º–ø—Ä–µ—Å—Å–∏—è: snappy
- Batch size: 16KB
- Linger time: 10ms
- Acks: all (–¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏)
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –≤–∫–ª—é—á–µ–Ω–∞

### –í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```properties
# –°–µ—Ç–µ–≤—ã–µ –ø–æ—Ç–æ–∫–∏
num.network.threads=8
num.io.threads=8

# –ë—É—Ñ–µ—Ä—ã
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400

# –†–µ–ø–ª–∏–∫–∞—Ü–∏—è
replica.fetch.max.bytes=1048576
num.replica.fetchers=4

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
unclean.leader.election.enable=false
min.insync.replicas=2
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã Kafka

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ø–∏–∫–æ–≤

```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–ø–∏–∫–æ–≤
/opt/kafka/bin/kafka-topics.sh --list --bootstrap-server localhost:9092

# –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ user-events
/opt/kafka/bin/kafka-topics.sh --describe --topic user-events --bootstrap-server localhost:9092
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã describe:**
```
Topic: user-events
Partition: 0    Leader: 1       Replicas: 1,2,3        Isr: 1,2,3
Partition: 1    Leader: 2       Replicas: 2,3,1        Isr: 2,3,1
Partition: 2    Leader: 3       Replicas: 3,1,2        Isr: 3,1,2
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Schema Registry

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
curl http://localhost:8081/subjects

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ö–µ–º
curl http://localhost:8081/subjects/user-events-value/versions
```

### –ó–∞–ø—É—Å–∫ Python –∫–ª–∏–µ–Ω—Ç–æ–≤

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
cd python
pip3 install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–¥—é—Å–µ—Ä–∞
python3 producer.py

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞
python3 consumer.py
```

## –°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª: `schemas/user-event.avsc`

–°—Ö–µ–º–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–æ–ª—è–º–∏:
- userId (string) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- eventType (enum) - —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è (LOGIN, LOGOUT, PURCHASE, VIEW_PRODUCT, ADD_TO_CART, REGISTER)
- timestamp (long) - –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è
- sessionId (string, optional) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–µ—Å—Å–∏–∏
- productId (string, optional) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞
- amount (double, optional) - —Å—É–º–º–∞ –¥–ª—è –ø–æ–∫—É–ø–æ–∫
- userAgent (string, optional) - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
- ipAddress (string, optional) - IP –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- metadata (map<string>, optional) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ JMX

–ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å JMX –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º:

- Zookeeper JMX: –ø–æ—Ä—Ç 9999
- Kafka Broker 1 JMX: –ø–æ—Ä—Ç 9991
- Kafka Broker 2 JMX: –ø–æ—Ä—Ç 9992  
- Kafka Broker 3 JMX: –ø–æ—Ä—Ç 9993
- Schema Registry JMX: –ø–æ—Ä—Ç 9994

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JConsole

```bash
jconsole localhost:9991  # –¥–ª—è Kafka Broker 1
jconsole localhost:9999  # –¥–ª—è Zookeeper
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∫–æ–º–∞–Ω–¥ curl

**–ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Schema Registry:**
```bash
curl http://localhost:8081/subjects
```
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `["user-events-value"]`

**–ö–æ–º–∞–Ω–¥–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Ä—Å–∏–π —Å—Ö–µ–º—ã:**
```bash
curl http://localhost:8081/subjects/user-events-value/versions
```
–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: `[1]`

### –õ–æ–≥–∏ –ø—Ä–æ–¥—é—Å–µ—Ä–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `python3 producer.py` –æ–∂–∏–¥–∞—é—Ç—Å—è –ª–æ–≥–∏ –≤–∏–¥–∞:
```
–ü—Ä–æ–¥—é—Å–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ç–æ–ø–∏–∫–∞ 'user-events'
Bootstrap —Å–µ—Ä–≤–µ—Ä—ã: localhost:9092,localhost:9093,localhost:9094

=== –û—Ç–ø—Ä–∞–≤–∫–∞ 20 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π ===
‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: LOGIN –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è user_3
  ‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ —Ç–æ–ø–∏–∫ 'user-events', –ø–∞—Ä—Ç–∏—Ü–∏—è 1, offset 0
‚úì –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ: PURCHASE –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è user_1
  ‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –≤ —Ç–æ–ø–∏–∫ 'user-events', –ø–∞—Ä—Ç–∏—Ü–∏—è 0, offset 0
...
‚úì –í—Å–µ 20 —Å–æ–±—ã—Ç–∏–π –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã
```

### –õ–æ–≥–∏ –∫–æ–Ω—Å—å—é–º–µ—Ä–∞

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ `python3 consumer.py` –æ–∂–∏–¥–∞—é—Ç—Å—è –ª–æ–≥–∏ –≤–∏–¥–∞:
```
–ö–æ–Ω—Å—å—é–º–µ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ç–æ–ø–∏–∫–∞ 'user-events'
–ì—Ä—É–ø–ø–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤: user-events-processor

üöÄ –ù–∞—á–∏–Ω–∞–µ–º —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ —Ç–æ–ø–∏–∫–∞ 'user-events'...

=== –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ ===
–ö–ª—é—á: user_3
–¢–æ–ø–∏–∫: user-events
–ü–∞—Ä—Ç–∏—Ü–∏—è: 1
Offset: 0
–í—Ä–µ–º—è: 2024-01-20 15:30:45
---
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: user_3
–¢–∏–ø —Å–æ–±—ã—Ç–∏—è: LOGIN
–°–µ—Å—Å–∏—è: 123e4567-e89b-12d3-a456-426614174000
IP: 192.168.1.100
  ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å user_3 –≤–æ—à–µ–ª –≤ —Å–∏—Å—Ç–µ–º—É
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã systemctl

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl restart zookeeper kafka kafka-2 kafka-3 schema-registry

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞
sudo systemctl stop kafka kafka-2 kafka-3 schema-registry zookeeper

# –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Ç–µ—Ä–∞
sudo systemctl start zookeeper
sleep 10
sudo systemctl start kafka kafka-2 kafka-3
sleep 10  
sudo systemctl start schema-registry
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
sudo systemctl stop kafka kafka-2 kafka-3 schema-registry zookeeper

# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ Kafka
sudo rm -rf /var/kafka-logs-*/*

# –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö Zookeeper
sudo rm -rf /var/lib/zookeeper/*

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ myid –¥–ª—è Zookeeper
echo "1" | sudo tee /var/lib/zookeeper/myid
sudo chown zookeeper:zookeeper /var/lib/zookeeper/myid
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`unclean.leader.election.enable=false`)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π ISR –¥–ª—è –∑–∞–ø–∏—Å–∏ (`min.insync.replicas=2`)
- –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫ (`acks=all`)

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω —Å—Ä–µ–¥—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
- SSL/TLS —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ
- SASL –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- ACL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –°–µ—Ç–µ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ Kafka
sudo journalctl -u kafka -n 50
sudo tail -f /opt/kafka/logs/server.log

# –õ–æ–≥–∏ Zookeeper  
sudo journalctl -u zookeeper -n 50
sudo tail -f /opt/kafka/logs/zookeeper.out

# –õ–æ–≥–∏ Schema Registry
sudo journalctl -u schema-registry -n 50
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tlnp | grep -E "(9092|9093|9094|2181|8081)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
sudo ss -tlnp | grep -E "(9092|9093|9094|2181|8081)"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h /var/kafka-logs-*

# –†–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤ –ø–æ —Ç–æ–ø–∏–∫–∞–º
du -sh /var/kafka-logs-*/*
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- –í—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (3 –±—Ä–æ–∫–µ—Ä–∞, 3 Zookeeper)
- –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è 3, min ISR 2)
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (JMX –º–µ—Ç—Ä–∏–∫–∏)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º–∞–º–∏ (Schema Registry)

–ö–ª–∞—Å—Ç–µ—Ä –≥–æ—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –Ω–∞–≥—Ä—É–∑–æ–∫ –∏ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—ã—Å—è—á–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –ø–æ—Ä—è–¥–∫–∞. 